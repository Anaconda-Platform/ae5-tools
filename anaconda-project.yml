name: ae5-tools
description: Command-line manipulation of Anaconda Enterprise 5.

variables:
# Used For System Tests
# This does NOT configure integration tests (these use a different mechanism as a requirement for mock management).
# This does NOT configure the build-time test execution as that occurs outside the scope of an anaconda-project.
# If running the system tests locally the below environment variables MUST be configured for the remote ae5 environment.
  AE5_HOSTNAME: 0.0.0.0
  AE5_USERNAME: mock-user
  AE5_PASSWORD: mock-password
  AE5_ADMIN_USERNAME: mock-adm-user
  AE5_ADMIN_PASSWORD: mock-adm-user-password
  AE5_K8S_ENDPOINT: ssh:centos
  AE5_K8S_PORT: 23456

commands:
  #
  # Run Time Commands
  #

  default:
    env_spec: default
    unix: python -m ae5_tools.k8s.server

  #
  # Development Time Commands
  #

  clean:
    env_spec: development
    unix: rm -rf .coverage coverage.xml .pytest_cache tests/integration/.pytest_cache

  bash:
    env_spec: development
    unix: bash

  test:
    env_spec: development
    unix: anaconda-project run clean && anaconda-project run test:unit && anaconda-project run test:integration && anaconda-project run test:system

  test:unit:
    env_spec: development
    unix: py.test --cov=ae5_tools -v tests/unit  --cov-append --cov-report=xml

  test:integration:
    env_spec: development
    unix: python -m tests.integration.setup

  test:system:
    env_spec: development
    unix: py.test --cov=ae5_tools -v tests/system  --cov-append --cov-report=xml

channels:
  - defaults
  - conda-forge

platforms:
  - linux-64
  - osx-64
  - osx-arm64
  - win-64

env_specs:
  default:
    description: Default environment spec for k8s server
    packages:
      - python>=3.6
      - python-dateutil
      - requests
      - aiohttp
  development:
    description: Development environment spec for running commands
    packages:
      - python>=3.7
      - python-dateutil
      - click>7
      - click-repl
      - requests
      - aiohttp
      - pytest
      - pytest-cov
      - pandas
      - python-dotenv
      - fastapi
      - uvicorn[standard]
      - starlette
      - anaconda-project
